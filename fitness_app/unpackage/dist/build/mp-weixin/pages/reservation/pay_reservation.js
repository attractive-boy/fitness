(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/reservation/pay_reservation"],{"0f47":function(e,t,a){"use strict";a.r(t);var i=a("e3a6"),n=a("ff98");for(var r in n)["default"].indexOf(r)<0&&function(e){a.d(t,e,(function(){return n[e]}))}(r);a("2008");var s=a("828b"),o=Object(s["a"])(n["default"],i["b"],i["c"],!1,null,"864e2ea6",null,!1,i["a"],void 0);t["default"]=o.exports},2008:function(e,t,a){"use strict";var i=a("d3a4"),n=a.n(i);n.a},"70db":function(e,t,a){"use strict";(function(e,t){var i=a("47a9");a("cda3");i(a("3240"));var n=i(a("0f47"));e.__webpack_require_UNI_MP_PLUGIN__=a,t(n.default)}).call(this,a("3223")["default"],a("df3c")["createPage"])},bf23:function(e,t,a){"use strict";(function(e){var i=a("47a9");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=i(a("7eb4")),r=i(a("af34")),s=i(a("ee10")),o=i(a("7ca3")),u=(a("d319"),a("915c")),c=a("2f37"),l=a("8f59");function f(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,i)}return a}var m={data:function(){return{orderId:void 0,times:[],currentTimes:0,timeData:[],startTime:null,endTime:null,chooseTime:[[],[]]}},computed:function(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?f(Object(a),!0).forEach((function(t){(0,o.default)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):f(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}({},(0,l.mapGetters)("systemModel",["shopInfo"])),onLoad:function(e){this.orderId=e.orderId,this.setReservationDate(),this.setTimes()},methods:{handlerReservation:function(){var t=this;return(0,s.default)(n.default.mark((function a(){var i,r,s,o;return n.default.wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(!e.$u.test.isEmpty(t.startTime)&&!e.$u.test.isEmpty(t.endTime)){a.next=3;break}return e.showToast({icon:"none",title:"请选择预约时间"}),a.abrupt("return");case 3:return i=[],r=new Date(t.startTime),s=new Date(t.endTime),t.timeData.forEach((function(e){e.forEach((function(e){var t=new Date(e.oriDate+" "+e.oriTime+":00");t>=r&&t<=s&&i.push({startTime:e.oriDate+" "+e.oriTime+":00",endTime:e.oriDate+" "+e.oriTime.split(":")[0]+":59:59"})}))})),a.next=9,(0,u.handlerRsvApi)({list:i,orderId:t.orderId});case 9:o=a.sent,200==o.code?(e.showToast({icon:"success",title:"预约成功"}),setTimeout((function(){t.setReservationDate(),t.goPayPage()}),500)):50001==o.code?e.showModal({title:"温馨提示",content:"暂无可用订单，是否前去购买",success:function(t){var a=t.confirm;a&&e.navigateTo({url:"/pages/cards/cards"})}}):e.showToast({icon:"none",title:o.msg,duration:2e3}),console.log(i);case 12:case"end":return a.stop()}}),a)})))()},setTimes:function(){var e=new Date,t=new Date;t.setDate(t.getDate()+1),this.times.push({date:(0,c.formatTimestamp)(e,0),title:"今天"}),this.times.push({date:(0,c.formatTimestamp)(t,0),title:"明天"})},setReservationDate:function(){var e=this,t=new Date,a=new Date;a.setDate(a.getDate()+1);var i=(0,c.formatTimestamp)(t,0),n=(0,c.formatTimestamp)(a,0);(0,u.getRsvDateApi)([{date:i},{date:n}]).then((function(t){var a=Object.keys(null!==t&&void 0!==t?t:{}).sort(),n=(new Date).getHours();a.forEach((function(a){var r=a===i?"今天 ":"明天 ",s=[];t[a].forEach((function(e){var t=e.time.split("-"),o=a.replace(/-/g,"/"),u=new Date(o+" "+t[0]).getHours();e.oriTime=e.time,e.oriDate=o,e.time=r+e.time,u>n&&a===i||a!==i||(e.available=!1,e.availableText="超过预约时间"),3==e.status?e.availableText="已预约":2==e.status&&(e.availableText="已约满"),s.push(e)})),e.timeData.push(s)}))}))},goPayPage:function(){e.navigateTo({url:"/pages/shop/pay?orderId="+this.orderId})},goCards:function(t,a){if(t.available){var i=this.chooseTime[this.currentTimes];this.currentTimes;if(0==this.currentTimes&&this.chooseTime.splice(1,1,[]),i.includes(a)){var n=i.filter((function(e){return e<a}));this.chooseTime.splice(this.currentTimes,1,n),0==this.currentTimes&&this.chooseTime.splice(1,1,[])}else{if(i.push(a),i.length>=2){for(var s=Math.min.apply(Math,(0,r.default)(i)),o=Math.max.apply(Math,(0,r.default)(i)),u=[],l=s;l<=o;l++)u.push(l);this.chooseTime.splice(this.currentTimes,1,u)}var f=this.chooseTime[0];if(1===this.currentTimes&&f.length>0){var m=Math.min.apply(Math,(0,r.default)(m)),h=[];this.timeData[0].forEach((function(e,t){e.available&&m<=t&&h.push(t)})),this.chooseTime.splice(0,1,h);for(var d=Math.min.apply(Math,(0,r.default)(i)),p=0;p<d;p++)i.push(p)}}var v=this.chooseTime[0],T=this.chooseTime[1],b=v.length>0?Math.min.apply(Math,(0,r.default)(v)):1/0,g=v.length>0?Math.max.apply(Math,(0,r.default)(v)):-1/0,D=T.length>0?Math.min.apply(Math,(0,r.default)(T)):1/0,w=T.length>0?Math.max.apply(Math,(0,r.default)(T)):-1/0,y=b!==1/0?this.timeData[0][b]:D!==1/0?this.timeData[1][D]:null,M=w!==-1/0?this.timeData[1][w]:g!==-1/0?this.timeData[0][g]:null;y&&M&&(this.startTime=y.oriDate+" "+y.oriTime+":00",this.endTime=M.oriDate+" "+M.oriTime+":00");var O=new Date(this.endTime);O.setMinutes(59),(0,c.isDiffOver2Hours)(new Date(this.startTime),O)&&e.showToast({icon:"none",title:"身体再好，也不能太累哦！"})}else e.showToast({icon:"none",title:t.availableText})}}};t.default=m}).call(this,a("df3c")["default"])},d3a4:function(e,t,a){},e3a6:function(e,t,a){"use strict";a.d(t,"b",(function(){return n})),a.d(t,"c",(function(){return r})),a.d(t,"a",(function(){return i}));var i={MNavbar:function(){return a.e("components/MNavbar/MNavbar").then(a.bind(null,"26d8"))},uParse:function(){return Promise.all([a.e("common/vendor"),a.e("uni_modules/uview-ui/components/u-parse/u-parse")]).then(a.bind(null,"93f1"))},uButton:function(){return Promise.all([a.e("common/vendor"),a.e("uni_modules/uview-ui/components/u-button/u-button")]).then(a.bind(null,"000c"))}},n=function(){var e=this,t=e.$createElement,a=(e._self._c,e.__map(e.timeData[e.currentTimes],(function(t,a){var i=e.__get_orig(t),n=3!=t.status?e.chooseTime[e.currentTimes].includes(a):null;return{$orig:i,g0:n}})));e._isMounted||(e.e0=function(t,a){var i=arguments[arguments.length-1].currentTarget.dataset,n=i.eventParams||i["event-params"];a=n.index;e.currentTimes=a}),e.$mp.data=Object.assign({},{$root:{l0:a}})},r=[]},ff98:function(e,t,a){"use strict";a.r(t);var i=a("bf23"),n=a.n(i);for(var r in i)["default"].indexOf(r)<0&&function(e){a.d(t,e,(function(){return i[e]}))}(r);t["default"]=n.a}},[["70db","common/runtime","common/vendor"]]]);