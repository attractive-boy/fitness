(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/reservation/update_reservation"],{"3b3f":function(e,t,a){"use strict";a.d(t,"b",(function(){return n})),a.d(t,"c",(function(){return r})),a.d(t,"a",(function(){return i}));var i={MNavbar:function(){return a.e("components/MNavbar/MNavbar").then(a.bind(null,"26d8"))},uParse:function(){return Promise.all([a.e("common/vendor"),a.e("uni_modules/uview-ui/components/u-parse/u-parse")]).then(a.bind(null,"93f1"))},uButton:function(){return Promise.all([a.e("common/vendor"),a.e("uni_modules/uview-ui/components/u-button/u-button")]).then(a.bind(null,"000c"))}},n=function(){var e=this,t=e.$createElement,a=(e._self._c,e.__map(e.timeData[e.currentTimes],(function(t,a){var i=e.__get_orig(t),n=e.chooseTime[e.currentTimes].includes(a);return{$orig:i,g0:n}})));e._isMounted||(e.e0=function(t,a){var i=arguments[arguments.length-1].currentTarget.dataset,n=i.eventParams||i["event-params"];a=n.index;e.currentTimes=a}),e.$mp.data=Object.assign({},{$root:{l0:a}})},r=[]},"6ba7":function(e,t,a){"use strict";a.r(t);var i=a("9739"),n=a.n(i);for(var r in i)["default"].indexOf(r)<0&&function(e){a.d(t,e,(function(){return i[e]}))}(r);t["default"]=n.a},"84a9":function(e,t,a){},9739:function(e,t,a){"use strict";(function(e){var i=a("47a9");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=i(a("7eb4")),r=i(a("af34")),s=i(a("ee10")),o=i(a("7ca3")),u=(a("d319"),a("915c")),c=a("2f37"),l=a("8f59");function m(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,i)}return a}var h={data:function(){return{rsrId:void 0,times:[],currentTimes:0,timeData:[],startTime:null,endTime:null,chooseTime:[[],[]]}},computed:function(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?m(Object(a),!0).forEach((function(t){(0,o.default)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):m(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}({},(0,l.mapGetters)("systemModel",["shopInfo"])),onLoad:function(e){this.rsrId=e.rsrId},onShow:function(){this.setReservationDate(),this.timeData=[],this.setTimes()},onShareAppMessage:function(){},onShareTimeline:function(){},methods:{handlerReservation:function(){var t=this;return(0,s.default)(n.default.mark((function a(){var i,r,s,o;return n.default.wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(!e.$u.test.isEmpty(t.startTime)&&!e.$u.test.isEmpty(t.endTime)){a.next=3;break}return e.showToast({icon:"none",title:"请选择预约时间"}),a.abrupt("return");case 3:return i=[],r=new Date(t.startTime),s=new Date(t.endTime),t.timeData.forEach((function(e){e.forEach((function(e){var t=new Date(e.oriDate+" "+e.oriTime+":00");t>=r&&t<=s&&i.push({startTime:e.oriDate+" "+e.oriTime+":00",endTime:e.oriDate+" "+e.oriTime.split(":")[0]+":59:59"})}))})),a.next=9,(0,u.delRsrApi)({list:i,id:t.rsrId});case 9:o=a.sent,200==o.code?(e.showToast({icon:"success",title:"取消成功"}),t.startTime=null,t.endTime=null,setTimeout((function(){t.setReservationDate(),e.navigateBack(),t.timeData=[],t.chooseTime=[[],[]]}),500)):50001==o.code?e.showToast({icon:"error",title:"绑定订单信息错误"}):e.showToast({icon:"none",title:o.msg,duration:2e3}),console.log(i);case 12:case"end":return a.stop()}}),a)})))()},setTimes:function(){var e=new Date,t=new Date;t.setDate(t.getDate()+1),this.times.push({date:(0,c.formatTimestamp)(e,0),title:"今天"}),this.times.push({date:(0,c.formatTimestamp)(t,0),title:"明天"})},setReservationDate:function(){var e=this,t=new Date,a=new Date;a.setDate(a.getDate()+1);var i=(0,c.formatTimestamp)(t,0),n=(0,c.formatTimestamp)(a,0);(0,u.getRsvDateApi)([{date:i},{date:n}]).then((function(t){var a=Object.keys(null!==t&&void 0!==t?t:{}).sort(),n=(new Date).getHours();a.forEach((function(a){var r=a===i?"今天 ":"明天 ",s=[];t[a].forEach((function(t,o){var u=t.time.split("-"),c=a.replace(/-/g,"/"),l=new Date(c+" "+u[0]).getHours();t.oriTime=t.time,t.oriDate=c,t.time=r+t.time,3==t.status?(t.available=!0,t.availableText="可预约",e.chooseTime[a===i?0:1].push(o)):2==t.status?t.availableText="已约满":1==t.status&&(t.availableText="可预约",l>n&&a===i||a!==i||(t.available=!1,t.availableText="超过预约时间")),s.push(t)})),e.timeData.push(s)}))}))},handlerChooseTime:function(t,a){var i=this;if(t.available){var n=this.timeData[this.currentTimes],s=this.chooseTime[this.currentTimes];this.currentTimes;if(s.includes(a)){var o=s.filter((function(e){return e<a||(n[e].num-=1),e<a}));0==this.currentTimes&&(console.log(this.currentTimes),this.chooseTime[1].forEach((function(e){i.timeData[1][e].num-=1}))),this.chooseTime.splice(this.currentTimes,1,o),0==this.currentTimes&&this.chooseTime.splice(1,1,[])}else{var u=this.chooseTime[0];if(s.push(a),n[a].num+=1,1===this.currentTimes&&u.length>0&&0!=a&&!s.includes(0)&&(s.push(0),n[0].num+=1),s.length>=2){for(var l=Math.min.apply(Math,(0,r.default)(s)),m=Math.max.apply(Math,(0,r.default)(s)),h=[],f=l;f<=m;f++)s.includes(f)||a==f||(n[f].num+=1),h.push(f);this.chooseTime.splice(this.currentTimes,1,h)}if(1===this.currentTimes&&u.length>0){for(var d=Math.min.apply(Math,(0,r.default)(u)),p=[],v=d;v<this.timeData[0].length;v++){var T=this.timeData[0][v];T.available&&(u.includes(v)||(T.num+=1),p.push(v))}this.chooseTime.splice(0,1,p);for(var b=Math.min.apply(Math,(0,r.default)(s)),D=0;D<b;D++)s.push(D)}}var g=this.chooseTime[0],w=this.chooseTime[1],M=g.length>0?Math.min.apply(Math,(0,r.default)(g)):1/0,y=g.length>0?Math.max.apply(Math,(0,r.default)(g)):-1/0,O=w.length>0?Math.min.apply(Math,(0,r.default)(w)):1/0,_=w.length>0?Math.max.apply(Math,(0,r.default)(w)):-1/0,P=M!==1/0?this.timeData[0][M]:O!==1/0?this.timeData[1][O]:null,j=_!==-1/0?this.timeData[1][_]:y!==-1/0?this.timeData[0][y]:null;P&&j&&(this.startTime=P.oriDate+" "+P.oriTime+":00",this.endTime=j.oriDate+" "+j.oriTime+":00");var x=new Date(this.endTime);x.setMinutes(59),(0,c.isDiffOver2Hours)(new Date(this.startTime),x)&&e.showToast({icon:"none",title:"身体再好，也不能太累哦！"})}else e.showToast({icon:"none",title:t.availableText})}}};t.default=h}).call(this,a("df3c")["default"])},b487:function(e,t,a){"use strict";var i=a("84a9"),n=a.n(i);n.a},bd8e:function(e,t,a){"use strict";(function(e,t){var i=a("47a9");a("cda3");i(a("3240"));var n=i(a("c39d"));e.__webpack_require_UNI_MP_PLUGIN__=a,t(n.default)}).call(this,a("3223")["default"],a("df3c")["createPage"])},c39d:function(e,t,a){"use strict";a.r(t);var i=a("3b3f"),n=a("6ba7");for(var r in n)["default"].indexOf(r)<0&&function(e){a.d(t,e,(function(){return n[e]}))}(r);a("b487");var s=a("828b"),o=Object(s["a"])(n["default"],i["b"],i["c"],!1,null,"0307a99a",null,!1,i["a"],void 0);t["default"]=o.exports}},[["bd8e","common/runtime","common/vendor"]]]);